<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Walt Jr. Quote Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    #chat-container {
      background: white;
      width: 100%;
      max-width: 600px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 8px;
    }
    #chat-log {
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 20px;
    }
    .message {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
    }
    .bot {
      background: #e1ecf4;
    }
    .user {
      background: #d2f8d2;
      text-align: right;
    }
    input[type="text"] {
      width: calc(100% - 100px);
      padding: 10px;
      font-size: 16px;
    }
    button {
      width: 80px;
      padding: 10px;
      font-size: 16px;
      margin-left: 10px;
    }
  </style>
</head>
<body>
<div id="chat-container">
  <div id="chat-log"></div>
  <div style="display: flex;">
    <input type="text" id="userInput" placeholder="Type your answer..." />
    <button onclick="handleInput()">Send</button>
  </div>
</div>

<script>
const questions = [
  "What size banner do you need? (e.g., 3x5 ft)",
  "What material would you like? (vinyl, mesh, fabric, etc.)",
  "Will you provide artwork, or do you need design help?",
  "Are there specific colors or full-color printing required?",
  "How many banners do you need?",
  "Do you need grommets, pole pockets, or hems?",
  "Will the banner be used indoors or outdoors?",
  "When do you need the banner by?",
  "Where should it be shipped or picked up?"
];

let currentStep = 0;
let quoteData = {};

function addMessage(text, sender) {
  const msg = document.createElement("div");
  msg.className = `message ${sender}`;
  msg.innerText = text;
  document.getElementById("chat-log").appendChild(msg);
  document.getElementById("chat-log").scrollTop = document.getElementById("chat-log").scrollHeight;
}

function handleInput() {
  const input = document.getElementById("userInput");
  const value = input.value.trim();
  if (!value) return;

  addMessage(value, "user");
  const key = questions[currentStep].split(" ")[0].toLowerCase();
  quoteData[key] = value;

  input.value = "";
  currentStep++;

  if (currentStep < questions.length) {
    setTimeout(() => addMessage(questions[currentStep], "bot"), 300);
  } else {
    sendQuote();
  }
}

function startChat() {
  addMessage(questions[currentStep], "bot");
}

async function sendQuote() {
  addMessage("Thanks! Generating your quote now...", "bot");

  try {
    const res = await fetch("https://waltjrv7.onrender.com/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: Object.values(quoteData).join("\n") })
    });
    const data = await res.json();
    addMessage(data.reply, "bot");

    await fetch("https://hook.us2.make.com/cnnrvbj8inymtg58fnua7n36hi13bj37", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(quoteData)
    });

  } catch (err) {
    addMessage("‚ùå There was a problem generating your quote. Please try again.", "bot");
    console.error(err);
  }
}

// Start a fresh chat every page load
startChat();

// Add keyboard support for Enter key
const inputBox = document.getElementById("userInput");
inputBox.addEventListener("keypress", function(event) {
  if (event.key === "Enter") {
    event.preventDefault();
    handleInput();
  }
});
</script>
</body>
</html>
